---
layout: post
title: "[TCP/IP] 브라우저에 url을 입력하면 일어나는 일"
sitemap: false
---

{:toc .large-only}

## 브라우저에 url을 입력하면 일어나는 일

브라우저에 url을 입력하면 가장 가까운 DNS 서버에 IP 주소를 요청한다.

DNS 서버에 조회한다는 것은 DNS 서버에 조회 메시지를 보내고, 응답 메시지를 받는다는 것을 의미한다.

브라우저 자체에는 메시지를 네트워크로 송출하는 기능이 없으므로 **Socket 라이브러리를 사용하여 OS의 프로토콜 스택을 호출**한다.

### Socket과 리졸버

Socket 라이브러리는 OS의 프로토콜 스택을 브라우저 등의 애플리케이션에서 호출하기 위한 프로그램 라이브러리이다.

Socket 라이브러리는 데이터를 송/수신하는 컴퓨터 사이에 파이프와 같은 통로를 연결하여 양방향으로 데이터를 전송한다.

<img src="/assets/img/blog/2022-12-30-tcp-ip_01.png" style="margin: 0 30px;">

**DNS 리졸버**는 Socket 라이브러리의 부품화된 프로그램 중 하나이며, DNS 서버에 요청 메시지를 보내고 응답 메시지를 받아 애플리케이션(브라우저)으로 전달하는 역할을 한다.

`gethostbyname`(리졸브의 프로그램명)과 웹 서버의 이름(www.lab.cyber.co.kr)으로 리졸버를 호출한다.

<img src="/assets/img/blog/2022-12-30-tcp-ip_02.png" style="margin-top: 30px;">

### 리졸버 내부의 작동

<img src="/assets/img/blog/2022-12-30-tcp-ip_03.png" style="margin-bottom: 30px;">

1. 리졸버를 호출하면 제어가 리졸버의 내부로 넘어간다. (브라우저에서 실행중인 동작이 일시정지 되고, 리졸버 코드로 넘어간다) [그림 2]
1. 리졸버가 DNS 서버에 문의하기 위한 메시지를 만들어 OS의 프로토콜 스택에 실행을 의뢰한다. [그림 3]
1. LAN 어댑터를 통해 메시지가 DNS 서버로 송신된다. [그림 4, 5]
1. DNS 서버가 응답 메시지를 클라이언트에게 반송한다. [그림 6]
1. 메시지가 네트워크와 프로토콜 스택을 경유하여 리졸브에게 전달된다. [그림 7, 8]
1. 리졸버가 내용을 해독하고 애플리케이션에 IP 주소를 건내준다. [그림 9]
1. 리졸버의 동작이 끝나고 제어가 애플리케이션(브라우저)에게 돌아온다. [그림 10]

## 브라우저의 데이터 송/수신

웹 서버에 메시지를 송/수신할 때도 리졸버를 통해 DNS 서버를 조회한 것과 마찬가지로 OS 내부에 있는 프로토콜 스택에 의뢰한다.

프로토콜 스택에 메시지 송신 동작을 의뢰할 떄는 Socket 라이브러리 프로그램 부품을 결정된 순번대로 호출한다.

### Socket의 송/수신 단계

<img src="/assets/img/blog/2022-12-30-tcp-ip_04.png" style="margin-bottom: 30px;">

1. socket을 호출하여 소켓을 만든다. [그림 1]
1. 위에서 만든 소켓에 파이프를 연결하여 서버측 소켓에 접속하도록 connect를 호출하여 프로토콜 스택에 의뢰한다. [그림 2]
1. 사용자가 입력한 URL을 바탕으로 만든 HTTP 리퀘스트 메시지를 write를 호출하여 송신한다. [그림 3]
1. 서버에서 반송한 응답 메시지를 read를 통해 프로토콜 스택에 수신 의뢰한다. [그림 3]
1. HTTP 응답 메시지 송신을 완료하면 웹 서버측에서 먼저 close를 호출하여 연결을 끊고, 이것이 클라이언트 측에 전달된다.
1. 클라이언트 소켓은 연결이 끊겼다는 사실을 브라우저에 통지하고 브라우저에서도 close를 호출하여 연결을 끊는다. [그림 4]
