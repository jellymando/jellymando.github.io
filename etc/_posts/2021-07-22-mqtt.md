---
layout: post
title: "MQTT κ²‰ν•¥κΈ°π‰"
sitemap: false
---

{:toc .large-only}

### MQTTμ μ΄ν•΄

- **M**essage **Q**ueuing **T**elemetry **T**ransport : μ§μ—­ν•λ©΄ λ©”μ‹μ§€ ν μ›κ²© μΈ΅μ • μ „μ†΅
- μ›κ²© μ μ–΄, μ›κ²© μΈ΅μ •μ„ μ„ν• ν†µμ‹  ν”„λ΅ν† μ½
- λ°ν–‰, κµ¬λ… λ¨λΈ κΈ°λ°μ λ©”μ‹μ§• ν”„λ΅ν† μ½
- Facebook messengerκ°€ MQTTλ¥Ό μ‚¬μ©ν–λ‹¤κ³  μ•λ ¤μ Έ μλ‹¤.
- κ²½λ‰μ΄λ©° λ°°ν„°λ¦¬ μλ…λ„ μ μ•½ν•  μ μμ–΄ IoTμ—μ„ λ§μ΄ ν™μ©

<br/>

<img src="/assets/img/blog/mqtt_01.png"><br/>
<img src="/assets/img/blog/mqtt_02.png">

### MQTTμ νΉμ§•

- μ μ—°μ„±
  - μ‹¤μ‹κ°„ ν‘Έμ‹ μ „μ†΅
  - μ „λ ¥μ‚¬μ© μµμ†ν™”
  - λΉ„λ™κΈ° λ©”μ‹μ§•
  - μ‹ λΆ°μ„±
- κ²½λ‰ν™”
  - κ²½λ‰ λ©”μ‹μ§€ ν¬λ©§
  - 80~100kb μ •λ„μ λ©”λ¨λ¦¬ ν¬κΈ°
- μ μ—°μ„±, ν™•μ¥μ„±
  - μ΄λ²¤νΈ λ°©μ‹ (λ‹¤μμ μ‚¬μ©μ, λ””λ°”μ΄μ¤ μ§€μ›)
  - μ‘μ©μ½”λ“ λ³€κ²½ μ—†μ΄ λ³€κ²½ κΈ°λ¥ ν™•μ¥ κ°€λ¥
- μƒμ‚°μ„±
  - νƒμ§€, μ €μ¥, μ „λ‹¬, λ°ν–‰/κµ¬λ… κΈ°λ¥ μ κ³µ (λ³„λ„μ μ‘μ© λ΅μ§ ν•„μ” μ—†μ)
  - κ°„λ‹¨ν• κ°λ…μΌλ΅ κ°λ°μμ ν•™μµ μ©μ΄ν•¨

<br/>

<img src="/assets/img/blog/mqtt_03.png">

### MQTTμ κµ¬μ΅°

- λ°ν–‰μ, ν† ν”½, λΈλ΅μ»¤, κµ¬λ…μλ΅ κµ¬μ„±
  - μ„λ²„-ν΄λΌμ΄μ–ΈνΈκ°€ μ•„λ‹ λΈλ΅μ»¤-ν΄λΌμ΄μ–ΈνΈ κµ¬μ΅°
  - λ°μ΄ν„°λ¥Ό λ°ν–‰ν•λ” λ°ν–‰μμ™€ κµ¬λ…ν•λ” κµ¬λ…μκ°€ μμ
- λ°ν–‰μμ™€ κµ¬λ…μκ°€ μ§μ ‘ λ©”μ‹μ§€λ¥Ό μ£Όκ³ λ°›μ§€ μ•λ” λΉ„λ™κΈ° λ°©μ‹
- κµ¬λ…μλ” λΈλ΅μ»¤λ¥Ό ν†µν•΄ κ΄€μ‹¬ μλ” Topicμ„ κµ¬λ… μ„ μ–Έν•λ‹¤.
- λ°ν–‰μκ°€ Topicμ— λ°μ΄ν„°λ¥Ό μ‹¤μ–΄ λΈλ΅μ»¤μ—κ² λ³΄λ‚΄λ©΄ λΈλ΅μ»¤κ°€ ν•΄λ‹Ή Topicμ„ κµ¬λ…ν•λ” κµ¬λ…μμ—κ² λ°μ΄ν„°λ¥Ό λ³΄λ‚Έλ‹¤.

<br/>

<img src="/assets/img/blog/mqtt_04.png"><br/>
<img src="/assets/img/blog/mqtt_05.png">

### MQTTμ ν¬λ§·

- κ³ μ • ν—¤λ”, κ°€λ³€ ν—¤λ”, νμ΄λ΅λ“ (= ν—¤λ”, ν† ν”½, νμ΄λ΅λ“)λ΅ λ‚λ‰¨
  - κ³ μ • ν—¤λ” : λ©”μ‹μ§€ νƒ€μ…(Message Type), ν”λκ·Έ(Flag), QoS λ λ²¨, Remaining Lengthλ¥Ό μ •μ
  - κ°€λ³€ ν—¤λ” : κ³ μ •ν—¤λ”μ™€ νμ΄λ΅λ“ μ‚¬μ΄μ— μ΅΄μ¬ν•λ©° ν”„λ΅ν† μ½μ μ΄λ¦„κ³Ό λ²„μ „, topic μ΄λ¦„μ„ ν¬ν•¨. ν† ν”½ μ΄λ¦„μ€ MQTT PUBLISH λ©”μ‹μ§€μ— ν¬ν•¨λλ©°, νμ΄λ΅λ“μ— ν¬ν•¨λ λ°μ΄ν„°λ¥Ό λ°ν–‰ ν•  λ• μ‚¬μ©ν•λ” μ±„λ„μ μ΄λ¦„
  - Payload : λ°μ΄ν„°, μ‹¤μ  μ „μ†΅λλ” λ©”μ„Έμ§€

<br/>

<img src="/assets/img/blog/mqtt_06.png"><br/>
<img src="/assets/img/blog/mqtt_07.png"><br/>
<img src="/assets/img/blog/mqtt_08.png"><br/>
<img src="/assets/img/blog/mqtt_09.png">

### Topicμ κµ¬μ΅°

- ν† ν”½μ€ μ¬λμ‹(/)λ¥Ό μ΄μ©ν•΄μ„ κ³„μΈµμ μΌλ΅ κµ¬μ„±ν•  μ μμ–΄ μ§κ΄€μ μ΄λ©°, λ§μ€ μ„Όμ„λ¥Ό κ΄€λ¦¬ν•κΈ° μ μ©ν•λ‹¤.
- ν† ν”½μ„ μ΄λ¦„μΌλ΅ ν•λ” λ©”μ‹μ§€ μ±„λ„μ„ λ§λ“ λ‹¤.
- bedroomμ μ¨λ„κ³„ μ„Όμ„λ¥Ό μ§€μΉ­ν•λ‹¤κ³  κ°€μ •ν•λ©΄ `house/bedroom/temperature`
- λ¨λ“  λ°©μ μ¨λ„κ³„λ¥Ό μ§€μΉ­ν•λ ¤λ©΄ `house/+/temperature` (+λ” ν•΄λ‹Ή λ λ²¨ μ™€μΌλ“μΉ΄λ“)
- bedroomμ λ¨λ“  μ„Όμ„λ¥Ό μ§€μΉ­ν•λ ¤λ©΄ `house/bedroom/#` (#λ” ν•μ„λ¥Ό λ¨λ‘ μ§€μΉ­ν•λ” μ™€μΌλ“μΉ΄λ“)

<br/>

<img src="/assets/img/blog/mqtt_10.png"><br/>

### QoS λ λ²¨

- **Q**uality **o**f **S**ervice
- λ°λ“μ‹ μ „λ‹¬λμ–΄μ•Ό ν•λ” μ¤‘μ” λ©”μ‹μ§€μ— λ€ν• μ „λ‹¬μ„ λ³΄μ¥
- QoSλ” λ°ν–‰μμ™€ κµ¬λ…μ λ¨λ‘ μ§€μ •ν•  μ μλ‹¤. μ΄λ• λ°ν–‰μκ°€ μ§€μ •ν• μµλ€ QoS λ λ²¨μ΄ μ°μ„ μ‹λλ‹¤.
- λ°ν–‰μκ°€ QoS λ λ²¨μ„ 2λ΅ μ§€μ •ν–λ‹¤λ©΄ κµ¬λ…μλ” 0, 1, 2 λ λ²¨ λ¨λ‘ κµ¬λ…ν•  μ μλ‹¤.
- λ°ν–‰μκ°€ QoS λ λ²¨μ„ 0μΌλ΅ μ§€μ •ν–λ‹¤λ©΄ κµ¬λ…μμ QoS λ λ²¨μ— μƒκ΄€μ—†μ΄ 0 λ λ²¨μ μ„λΉ„μ¤λ¥Ό λ°›κ² λλ‹¤.
- QoS 0
  - λ°ν–‰μ(ν΄λΌμ΄μ–ΈνΈ)λ” λ©”μ‹μ§€λ¥Ό λ³΄λ‚Έ ν›„ κµ¬λ…μμ μμ‹  μ—¬λ¶€μ™€ μƒκ΄€μ—†μ΄ λ©”μ‹μ§€λ¥Ό μ‚­μ ν•λ‹¤.
  - λ©”μ‹μ§€κ°€ μµλ€ 1λ² μ „λ‹¬λλ©°, μ „λ‹¬ μ—¬λ¶€λ¥Ό ν™•μΈν•μ§€ μ•μΌλ―€λ΅ μ μ‹¤ κ°€λ¥μ„±μ΄ μλ‹¤.
- QoS 1
  - λ©”μ‹μ§€ μ „μ†΅μ΄ μ™„λ£λλ©΄ μ„λ²„λ” λ°ν–‰ μ™„λ£ μ‘λ‹µλ©”μ‹μ§€λ¥Ό λ°ν–‰μμ—κ² μ „μ†΅ν•κ³ , μ΄ λ©”μ‹μ§€λ¥Ό λ°›μ€ λ°ν–‰μλ” μ „μ†΅μ΄ μ™„λ£λ κ²ƒμΌλ΅ νλ‹¨
  - κµ¬λ…μλ” λ©”μ‹μ§€λ¥Ό μ λ°›μ•λ”μ§€μ μ—¬λ¶€λ¥Ό μ„λ²„μ— μ„μ„ν•κ³ , λ°ν–‰μλ” μ„λ²„μ PUBACK λ©”μ‹μ§€λ§ μ²΄ν¬
  - λ©”μ‹μ§€κ°€ μµμ† 1λ² μ „λ‹¬λλ©°, μ „λ‹¬ μ—¬λ¶€λ¥Ό ν™•μΈν•μ§€λ§ μ¤‘λ³µ μ „λ‹¬ν•  κ°€λ¥μ„±μ΄ μλ‹¤.
- QoS 2
  - λ©”μ‹μ§€ μ „μ†΅μ΄ μ™„λ£λλ©΄ μ„λ²„λ” λ°ν–‰λ λ©”μ‹μ§€κ°€ μ ‘μλμ—λ‹¤λ” PUBREC λ©”μ‹μ§€λ¥Ό λ°ν–‰μμ—κ² μ „μ†΅
  - λ°ν–‰μλ” PUBREC λ©”μ‹μ§€λ¥Ό λ°›κ³  μ„λ²„μ— λ©”μ‹μ§€μ— λ€ν• λ³΄μ¥ λ°°λ‹¬μ„ μ¬μ”μ²­ν•λ” PUBREL μ „μ†΅
  - μ΄λ¥Ό λ°›μ€ μ„λ²„λ” κµ¬λ…μκ°€ λ©”μ‹μ§€ ν™•μΈμ„ ν• ν›„ λ©”μ‹μ§€ μ „μ†΅μ„ μ™„λ£ν•λ©° μ΄λ¥Ό λ°ν–‰μμ—κ² μ•λ¦Ό
  - λ©”μ‹μ§€κ°€ λ‹¨ ν• λ², μ •ν™•ν•κ² μ „λ‹¬λλ‹¤.

<br/>

<img src="/assets/img/blog/mqtt_11.png"><br/>
<img src="/assets/img/blog/mqtt_12.png"><br/>
<img src="/assets/img/blog/mqtt_13.png"><br/>
<img src="/assets/img/blog/mqtt_14.png"><br/>
<img src="/assets/img/blog/mqtt_15.png"><br/>

### μ—°κ²° μ μ‹¤

ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ κ°„μ μ—°κ²°μ„ μƒμ—μ„ λ• μ΄λ¥Ό λ³΄μ •ν•κΈ° μ„ν• MQTT μμ²΄ κΈ°λ¥

- Last Will And Testament : ν΄λΌμ΄μ–ΈνΈκ°€ μκ³  μ—†μ΄ μ—°κ²°μ„ μƒμ—μ„ λ• μ΄λ²¤νΈκ°€ μ„λ²„μ—μ„ λ°μƒ, μ„λ²„ μΈ΅μ—μ„ μ—°κ²° μ μ‹¤ μ—¬λ¶€λ¥Ό μΈμ§€
- μ¥κΈ° κµ¬λ… : μ„λ²„μ— ν΄λΌμ΄μ–ΈνΈμ κµ¬λ… μ •λ³΄ μ €μ¥λ¨, μ„Έμ… μΆ…λ£ ν›„ μ¬μ ‘μ† μ‹μ—λ„ μ¬μ‘μ—… μ—†μ΄ λ°ν–‰/κµ¬λ… μ μ§€
- ν΄λ¦° μ„Έμ… : μ—°κ²° ν•΄μ  ν›„ λ‹¤μ‹ μ—°κ²°λμ—μ„ λ• μ΄μ „ μ„Έμ… μ μ§€/μ‚­μ  μ„ νƒ

### λ©”μ‹μ§€ μ‹ν€€μ¤

- λ‹¨κΈ° κµ¬λ…
  - μ„Έμ… μλ… μ£ΌκΈ° λ‚΄μ—μ„ κµ¬λ… μ”μ²­ λ©”μ‹μ§€μ™€ μΆ…λ£ λ©”μ‹μ§€λ΅ κµ¬λ… μλ… μ£ΌκΈ°λ¥Ό μ΄λ£Έ
  - ν† ν”½ λ©”μ‹μ§€λ” κµ¬λ… μλ… μ£ΌκΈ° μ•μ—μ„ μ „μ†΅λλ‹¤.
- μ¥κΈ° κµ¬λ…
  - κµ¬λ… μλ… μ£ΌκΈ° λ‚΄μ—μ„ μ„Έμ…μ΄ μƒμ„±λκ³  μΆ…λ£λ  μ μμ
  - μ„λ²„μ— ν΄λΌμ΄μ–ΈνΈμ κµ¬λ… μ •λ³΄κ°€ μ €μ¥λλ―€λ΅ μ„Έμ… μΆ…λ¥ ν›„ μ¬μ—°κ²° μ‹μ—λ„ μ¬μ‘μ—… μ—†μ΄ λ°ν–‰/κµ¬λ… μ μ§€ κ°€λ¥
- Kepp Alive
  - μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° μ„¤μ •λ μ‹κ°„(Keep Alive Timer) μ΄μƒ λ©”μ‹μ§€κ°€ μ¤μ§€ μ•μΌλ©΄ μ—°κ²°μ„ ν•΄μ§€
  - μ—°κ²°μ΄ ν•΄μ§€λλ©΄ ν΄λΌμ΄μ–ΈνΈλ” μ—°κ²°μ„ μ μ§€ν•κΈ° μ„ν•΄ λ°ν–‰ λ©”μ‹μ§€λ¥Ό λ€μ‹ ν•μ—¬ ν•‘ λ©”μ‹μ§€ μ „μ†΅ν•κ³ , μ΄ λ©”μ‹μ§€κ°€ λ„μ°©ν•λ©΄ νƒ€μ΄λ¨Έκ°€ λ‹¤μ‹ μ‹μ‘λλ©΄μ„ μ—°κ²°μ΄ μ μ§€λ¨
- Will λ©”μ„Έμ§€
  - ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ— μ—°κ²°ν•  λ• Will ν”λκ·Έλ¥Ό μ„Έν…ν•λ©΄, μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈκ°€ μ—°κ²° μΆ…λ£λμ—μ„ λ• λ¨λ“  κ΄€λ ¨ κµ¬λ…μμ—κ² Will λ©”μ‹μ§€λ¥Ό μ „λ‹¬ν•μ—¬ ν•΄λ‹Ή ν΄λΌμ΄μ–ΈνΈμ μ—°κ²° μƒνƒλ¥Ό μ•λ¦Ό
  - Will ν”λκ·Έ, Will QoS, Will Retain λ“±μ„ μ„Έν…

<br/>

<img src="/assets/img/blog/mqtt_16.png"><br/>
<img src="/assets/img/blog/mqtt_17.png"><br/>
<img src="/assets/img/blog/mqtt_18.png">

<br/>

[MQTT](https://jeongchul.tistory.com/296)<br/>
[[Youtube] #4. MQTT - IoT α„‘α…³α„…α…¦α„‹α…µα†·α„‹α…―α„α…³ α„€α…®α„α…®α†¨](https://youtu.be/5bJVr2d6IL0)
